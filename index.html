<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¶ é»è¨ˆæ™‚å™¨ v0.7</title>
    <style>
        body, html {
            margin: 0; padding: 0;
            height: 100%; width: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f8f9fa;
        }

        /* ä¸ŠåŠéƒ¨ï¼šæ»‘å‹•å®¹å™¨ */
        #top-section {
            height: 50vh;
            width: 100%;
            background: #ffffff;
            border-bottom: 1px solid #eee;
            position: relative;
            overflow: hidden;
            touch-action: none; /* ç¦ç”¨ç€è¦½å™¨é è¨­æ‰‹å‹¢ */
        }

        #slider {
            display: flex;
            width: 200%;
            height: 100%;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .slide-page {
            width: 50%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        #green-dot {
            width: 120px;
            height: 120px;
            background-color: #008000;
            border-radius: 50%;
            transform: translate(0, 0) scale(1);
            touch-action: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        #buddha-img {
            max-height: 95%;
            max-width: 95%;
            transform: translate(0, 0) scale(1); /* æ”¯æ´ä½ç§»èˆ‡ç¸®æ”¾ */
            touch-action: none;
            object-fit: contain;
            cursor: move;
        }

        /* ä¸‹åŠéƒ¨ï¼šç¢¼è¡¨ + æŒ‰éˆ• */
        #bottom-section {
            height: 50vh;
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            padding-top: 20px;
            gap: 10px;
            background: #f8f9fa;
            z-index: 10;
        }

        #timer-display {
            font-size: 3.5rem;
            font-weight: 700;
            font-family: monospace;
            color: #222;
            margin-bottom: 5px;
        }

        .btn-container {
            width: 90%;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .btn {
            padding: 15px;
            font-size: 1.2rem;
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            flex: 1 1 40%;
            transition: all 0.2s;
        }

        #start-pause-btn { background-color: #2ecc71; }
        #start-pause-btn.pausing { background-color: #f39c12; }
        #reset-btn { background-color: #95a5a6; }
        #reset-btn:disabled { background-color: #dcdde1; color: #7f8c8d; cursor: not-allowed; opacity: 0.6; }
        #stop-btn { background-color: #e74c3c; width: 90%; flex: 1 1 90%; }

        #version-tag { position: fixed; left: 10px; bottom: 10px; font-size: 12px; color: #999; }
        #drawer-toggle {
            position: fixed; right: 15px; bottom: 15px; background: #444; color: white;
            width: 44px; height: 44px; border-radius: 50%; display: flex;
            justify-content: center; align-items: center; z-index: 101;
        }
        #drawer {
            position: fixed; right: -300px; top: 0; width: 260px; height: 100%;
            background: white; z-index: 102; padding: 20px; transition: 0.3s ease;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
        }
        #drawer.open { right: 0; }
        .record-item { padding: 12px; border-bottom: 1px solid #eee; font-size: 0.9rem; }

        .dots-nav {
            position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 8px;
        }
        .dot-nav { width: 8px; height: 8px; border-radius: 50%; background: #ccc; }
        .dot-nav.active { background: #008000; }
    </style>
</head>
<body>

    <div id="top-section">
        <div id="slider">
            <div class="slide-page"><div id="green-dot"></div></div>
            <div class="slide-page">
                <img id="buddha-img" src="1000010289.png" alt="å¤§è‡ªåœ¨ç‹ä½›">
            </div>
        </div>
        <div class="dots-nav">
            <div id="dot1" class="dot-nav active"></div>
            <div id="dot2" class="dot-nav"></div>
        </div>
    </div>

    <div id="bottom-section">
        <div id="timer-display">00:00:00</div>
        <div class="btn-container">
            <button id="start-pause-btn" class="btn">é–‹å§‹</button>
            <button id="reset-btn" class="btn" disabled>æ­¸é›¶</button>
            <button id="stop-btn" class="btn">çµæŸä¸¦è¨˜éŒ„</button>
        </div>
    </div>

    <div id="version-tag">v0.7</div>

    <div id="drawer-toggle" onclick="toggleDrawer()">ğŸ“‹</div>
    <div id="drawer">
        <h3 style="display:flex; justify-content: space-between;">æœ¬åœ°ç·´ç¿’è¨˜éŒ„ <span onclick="toggleDrawer()" style="cursor:pointer">âœ•</span></h3>
        <div id="record-list"></div>
        <span style="font-size: 10px; color: #e74c3c; text-decoration: underline; cursor: pointer;" onclick="clearAllRecords()">æ¸…é™¤æ­¤æ‰‹æ©Ÿæ‰€æœ‰è¨˜éŒ„</span>
    </div>

    <script>
        // --- 1. æ»‘å‹•åˆ‡æ› (ä¿®æ­£å¾Œçš„é‚è¼¯ï¼Œé¿å…èˆ‡æ‹–å‹•è¡çª) ---
        const slider = document.getElementById('slider');
        const topSection = document.getElementById('top-section');
        const dot1 = document.getElementById('dot1');
        const dot2 = document.getElementById('dot2');
        let startX = 0, currentSlide = 0, isSliderAction = false;

        topSection.addEventListener('touchstart', (e) => {
            if (e.touches.length === 1) {
                startX = e.touches[0].pageX;
                isSliderAction = true;
            } else {
                isSliderAction = false;
            }
        }, {passive: true});

        topSection.addEventListener('touchend', (e) => {
            if (isSliderAction && e.changedTouches.length === 1) {
                let diff = startX - e.changedTouches[0].pageX;
                // åªæœ‰åœ¨å¿«é€Ÿä¸”é•·è·é›¢æ»‘å‹•æ™‚æ‰åˆ‡æ›é é¢
                if (Math.abs(diff) > 80) {
                    currentSlide = diff > 0 ? 1 : 0;
                    slider.style.transform = `translateX(-${currentSlide * 50}%)`;
                    dot1.classList.toggle('active', currentSlide === 0);
                    dot2.classList.toggle('active', currentSlide === 1);
                }
            }
        });

        // --- 2. å¼·åŒ–ç‰ˆç¸®æ”¾èˆ‡æ‹–å‹•åŠŸèƒ½ (æ”¯æ´ä¸Šä¸‹ç§»å‹•) ---
        function setupEnhancedTouch(id) {
            let el = document.getElementById(id);
            let scale = 1, lastScale = 1;
            let posX = 0, posY = 0, lastPosX = 0, lastPosY = 0;
            let startDist = 0, startX = 0, startY = 0;

            el.addEventListener('touchstart', (e) => {
                if (e.touches.length === 1) {
                    // å–®æŒ‡ï¼šæº–å‚™æ‹–å‹•
                    startX = e.touches[0].pageX;
                    startY = e.touches[0].pageY;
                } else if (e.touches.length === 2) {
                    // å…©æŒ‡ï¼šæº–å‚™ç¸®æ”¾
                    startDist = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
                }
            }, {passive: false});

            el.addEventListener('touchmove', (e) => {
                e.preventDefault(); // é˜²æ­¢æ»¾å‹•é é¢

                if (e.touches.length === 1) {
                    // åŸ·è¡Œå¹³ç§» (åƒ…åœ¨ä½›åƒé é¢æˆ–ç¶ é»é é¢å…§éƒ¨ç§»å‹•)
                    let dx = e.touches[0].pageX - startX;
                    let dy = e.touches[0].pageY - startY;
                    posX = lastPosX + dx;
                    posY = lastPosY + dy;
                    updateTransform();
                } else if (e.touches.length === 2) {
                    // åŸ·è¡Œç¸®æ”¾
                    let d = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
                    scale = lastScale * (d / startDist);
                    if (scale < 0.2) scale = 0.2;
                    if (scale > 15) scale = 15;
                    updateTransform();
                }
            }, { passive: false });

            el.addEventListener('touchend', (e) => {
                lastPosX = posX;
                lastPosY = posY;
                lastScale = scale;
            });

            function updateTransform() {
                el.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;
            }
        }

        setupEnhancedTouch('green-dot');
        setupEnhancedTouch('buddha-img');

        // --- 3. è¨ˆæ™‚èˆ‡å„²å­˜é‚è¼¯ (ä¿ç•™ v0.5/v0.6) ---
        let timerInterval, elapsedTime = 0, startTime, running = false;
        const display = document.getElementById('timer-display'), startPauseBtn = document.getElementById('start-pause-btn'), resetBtn = document.getElementById('reset-btn'), recordList = document.getElementById('record-list');

        window.onload = () => {
            const saved = JSON.parse(localStorage.getItem('my_timer_records') || '[]');
            saved.forEach(rec => renderRecord(rec.duration, rec.time));
        };

        function formatTime(ms) {
            let m = Math.floor(ms / 60000), s = Math.floor((ms % 60000) / 1000), mil = Math.floor((ms % 1000) / 10);
            return `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}:${String(mil).padStart(2, '0')}`;
        }

        startPauseBtn.onclick = () => {
            if (!running) {
                startTime = Date.now();
                timerInterval = setInterval(() => { display.innerText = formatTime(elapsedTime + (Date.now() - startTime)); }, 10);
                running = true; resetBtn.disabled = true;
                startPauseBtn.innerText = "æš«åœ"; startPauseBtn.classList.add("pausing");
            } else {
                clearInterval(timerInterval); elapsedTime += (Date.now() - startTime);
                running = false; startPauseBtn.innerText = "é–‹å§‹"; startPauseBtn.classList.remove("pausing");
            }
        };

        resetBtn.onclick = () => { elapsedTime = 0; display.innerText = "00:00:00"; resetBtn.disabled = true; };

        document.getElementById('stop-btn').onclick = () => {
            let final = elapsedTime + (running ? (Date.now() - startTime) : 0);
            if (final > 0) {
                const d = formatTime(final), t = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', second:'2-digit'});
                renderRecord(d, t);
                const records = JSON.parse(localStorage.getItem('my_timer_records') || '[]');
                records.unshift({ duration: d, time: t });
                localStorage.setItem('my_timer_records', JSON.stringify(records));
                clearInterval(timerInterval); elapsedTime = final; running = false;
                resetBtn.disabled = false; startPauseBtn.innerText = "é–‹å§‹"; startPauseBtn.classList.remove("pausing");
            }
        };

        function renderRecord(d, t) {
            const div = document.createElement('div'); div.className = 'record-item';
            div.innerHTML = `<b>è€—æ™‚:</b> ${d}<br><small>çµæŸæ–¼ ${t}</small>`;
            recordList.prepend(div);
        }

        function clearAllRecords() { if(confirm("ç¢ºå®šæ¸…é™¤ç´€éŒ„ï¼Ÿ")) { localStorage.removeItem('my_timer_records'); recordList.innerHTML = ''; } }
        function toggleDrawer() { document.getElementById('drawer').classList.toggle('open'); }
    </script>
</body>
</html>
