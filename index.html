<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç¶ é»è¨ˆæ™‚å™¨ v0.6 - ä½›å­¸ç·´ç¿’ç‰ˆ</title>
    <style>
        body, html {
            margin: 0; padding: 0;
            height: 100%; width: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f8f9fa;
        }

        /* ä¸ŠåŠéƒ¨ï¼šæ»‘å‹•å®¹å™¨ */
        #top-section {
            height: 50vh;
            width: 100%;
            background: #ffffff;
            border-bottom: 1px solid #eee;
            position: relative;
            overflow: hidden;
        }

        #slider {
            display: flex;
            width: 200%; /* å…©å€å¯¬åº¦æ”¾å…©å€‹é é¢ */
            height: 100%;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .slide-page {
            width: 50%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        /* ç¶ é»æ¨£å¼ */
        #green-dot {
            width: 120px;
            height: 120px;
            background-color: #008000;
            border-radius: 50%;
            transform: scale(1);
            touch-action: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        /* ä½›åƒæ¨£å¼ */
        #buddha-img {
            max-height: 90%;
            max-width: 90%;
            transform: scale(1);
            touch-action: none;
            object-fit: contain;
        }

        /* ä¸‹åŠéƒ¨ï¼šç¢¼è¡¨ + æŒ‰éˆ• */
        #bottom-section {
            height: 50vh;
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            padding-top: 20px;
            gap: 10px;
            background: #f8f9fa;
        }

        #timer-display {
            font-size: 3.5rem;
            font-weight: 700;
            font-family: monospace;
            color: #222;
            margin-bottom: 5px;
        }

        .btn-container {
            width: 90%;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .btn {
            padding: 15px;
            font-size: 1.2rem;
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            flex: 1 1 40%;
            transition: all 0.2s;
        }

        #start-pause-btn { background-color: #2ecc71; }
        #start-pause-btn.pausing { background-color: #f39c12; }
        #reset-btn { background-color: #95a5a6; }
        #reset-btn:disabled {
            background-color: #dcdde1;
            color: #7f8c8d;
            cursor: not-allowed;
            opacity: 0.6;
        }
        #stop-btn { background-color: #e74c3c; width: 90%; flex: 1 1 90%; }

        .btn:active:not(:disabled) { opacity: 0.8; }

        /* ç‰ˆæœ¬èˆ‡å´æ¬„ */
        #version-tag { position: fixed; left: 10px; bottom: 10px; font-size: 12px; color: #999; }
        #drawer-toggle {
            position: fixed; right: 15px; bottom: 15px; background: #444; color: white;
            width: 44px; height: 44px; border-radius: 50%; display: flex;
            justify-content: center; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.3); z-index: 101;
        }
        #drawer {
            position: fixed; right: -300px; top: 0; width: 260px; height: 100%;
            background: white; box-shadow: -4px 0 15px rgba(0,0,0,0.1);
            transition: 0.3s ease; z-index: 102; padding: 20px; overflow-y: auto;
        }
        #drawer.open { right: 0; }
        .record-item { padding: 12px; border-bottom: 1px solid #eee; font-size: 0.9rem; }
        .clear-storage { font-size: 10px; color: #e74c3c; text-decoration: underline; margin-top: 20px; display: block; }
        
        /* æŒ‡ç¤ºé» */
        .dots-nav {
            position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 8px;
        }
        .dot-nav { width: 8px; height: 8px; border-radius: 50%; background: #ccc; }
        .dot-nav.active { background: #008000; }
    </style>
</head>
<body>

    <div id="top-section">
        <div id="slider">
            <div class="slide-page">
                <div id="green-dot"></div>
            </div>
            <div class="slide-page">
                <img id="buddha-img" src="https://raw.githubusercontent.com/moonrain1204/green-dot-timer/main/1000010289.png" alt="å¤§è‡ªåœ¨ç‹ä½›" onerror="this.src='https://i.imgur.com/8N69FmK.png'">
            </div>
        </div>
        <div class="dots-nav">
            <div id="dot1" class="dot-nav active"></div>
            <div id="dot2" class="dot-nav"></div>
        </div>
    </div>

    <div id="bottom-section">
        <div id="timer-display">00:00:00</div>
        <div class="btn-container">
            <button id="start-pause-btn" class="btn">é–‹å§‹</button>
            <button id="reset-btn" class="btn" disabled>æ­¸é›¶</button>
            <button id="stop-btn" class="btn">çµæŸä¸¦è¨˜éŒ„</button>
        </div>
    </div>

    <div id="version-tag">v0.6</div>

    <div id="drawer-toggle" onclick="toggleDrawer()">ğŸ“‹</div>
    <div id="drawer">
        <h3 style="display:flex; justify-content: space-between;">æœ¬åœ°ç·´ç¿’è¨˜éŒ„ <span onclick="toggleDrawer()" style="cursor:pointer">âœ•</span></h3>
        <div id="record-list"></div>
        <span class="clear-storage" onclick="clearAllRecords()">æ¸…é™¤æ­¤æ‰‹æ©Ÿæ‰€æœ‰è¨˜éŒ„</span>
    </div>

    <script>
        // --- 1. æ»‘å‹•åˆ‡æ›é‚è¼¯ ---
        const slider = document.getElementById('slider');
        const topSection = document.getElementById('top-section');
        const dot1 = document.getElementById('dot1');
        const dot2 = document.getElementById('dot2');
        let startX = 0;
        let currentSlide = 0;

        topSection.addEventListener('touchstart', (e) => {
            if (e.touches.length === 1) startX = e.touches[0].pageX;
        });

        topSection.addEventListener('touchend', (e) => {
            if (e.changedTouches.length === 1) {
                let diff = startX - e.changedTouches[0].pageX;
                if (Math.abs(diff) > 50) { // æ»‘å‹•é–€æª»
                    if (diff > 0) currentSlide = 1; // å¾€å·¦æ»‘çœ‹ç¬¬äºŒé 
                    else currentSlide = 0; // å¾€å³æ»‘å›ç¬¬ä¸€é 
                    updateSlider();
                }
            }
        });

        function updateSlider() {
            slider.style.transform = `translateX(-${currentSlide * 50}%)`;
            dot1.classList.toggle('active', currentSlide === 0);
            dot2.classList.toggle('active', currentSlide === 1);
        }

        // --- 2. ç¨ç«‹ç¸®æ”¾é‚è¼¯ (å°è£åŠŸèƒ½) ---
        function setupZoom(elementId) {
            let el = document.getElementById(elementId);
            let scale = 1;
            let startDist = 0;

            el.addEventListener('touchstart', (e) => {
                if (e.touches.length === 2) {
                    startDist = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
                }
            });

            el.addEventListener('touchmove', (e) => {
                if (e.touches.length === 2 && startDist > 0) {
                    e.preventDefault();
                    const currentDist = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
                    let newScale = scale * (currentDist / startDist);
                    if (newScale > 0.2 && newScale < 10) el.style.transform = `scale(${newScale})`;
                }
            }, { passive: false });

            el.addEventListener('touchend', (e) => {
                if (e.touches.length < 2) {
                    const transform = window.getComputedStyle(el).getPropertyValue('transform');
                    if (transform !== 'none') {
                        const values = transform.split('(')[1].split(')')[0].split(',');
                        scale = Math.sqrt(values[0]*values[0] + values[1]*values[1]);
                    }
                    startDist = 0;
                }
            });
        }

        setupZoom('green-dot');
        setupZoom('buddha-img');

        // --- 3. è¨ˆæ™‚èˆ‡å„²å­˜é‚è¼¯ (ä¿ç•™ v0.5) ---
        let timerInterval, elapsedTime = 0, startTime, running = false;
        const display = document.getElementById('timer-display');
        const startPauseBtn = document.getElementById('start-pause-btn');
        const resetBtn = document.getElementById('reset-btn');
        const recordListContainer = document.getElementById('record-list');

        window.onload = () => {
            const savedRecords = JSON.parse(localStorage.getItem('my_timer_records') || '[]');
            savedRecords.forEach(rec => renderRecord(rec.duration, rec.time));
        };

        function updateTime() {
            const now = Date.now();
            display.innerText = formatTime(elapsedTime + (now - startTime));
        }

        function formatTime(ms) {
            let m = Math.floor(ms / 60000);
            let s = Math.floor((ms % 60000) / 1000);
            let mil = Math.floor((ms % 1000) / 10);
            return `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}:${String(mil).padStart(2, '0')}`;
        }

        startPauseBtn.onclick = () => {
            if (!running) {
                startTime = Date.now();
                timerInterval = setInterval(updateTime, 10);
                running = true;
                resetBtn.disabled = true;
                startPauseBtn.innerText = "æš«åœ";
                startPauseBtn.classList.add("pausing");
            } else {
                clearInterval(timerInterval);
                elapsedTime += (Date.now() - startTime);
                running = false;
                startPauseBtn.innerText = "é–‹å§‹";
                startPauseBtn.classList.remove("pausing");
            }
        };

        resetBtn.onclick = () => {
            if (!resetBtn.disabled) {
                elapsedTime = 0;
                display.innerText = "00:00:00";
                resetBtn.disabled = true;
            }
        };

        document.getElementById('stop-btn').onclick = () => {
            let finalTimeMs = elapsedTime;
            if (running) finalTimeMs += (Date.now() - startTime);
            if (finalTimeMs > 0) {
                const durationStr = formatTime(finalTimeMs);
                const timeStr = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
                saveToLocalStorage(durationStr, timeStr);
                renderRecord(durationStr, timeStr);
                clearInterval(timerInterval);
                elapsedTime = finalTimeMs;
                running = false;
                resetBtn.disabled = false;
                startPauseBtn.innerText = "é–‹å§‹";
                startPauseBtn.classList.remove("pausing");
            }
        };

        function saveToLocalStorage(duration, time) {
            const records = JSON.parse(localStorage.getItem('my_timer_records') || '[]');
            records.unshift({ duration, time });
            localStorage.setItem('my_timer_records', JSON.stringify(records));
        }

        function renderRecord(duration, time) {
            const div = document.createElement('div');
            div.className = 'record-item';
            div.innerHTML = `<b>è€—æ™‚:</b> ${duration}<br><small style="color:#666">çµæŸæ–¼ ${time}</small>`;
            recordListContainer.prepend(div);
        }

        function clearAllRecords() {
            if(confirm("ç¢ºå®šè¦åˆªé™¤é€™éš»æ‰‹æ©Ÿä¸Šçš„æ‰€æœ‰è¨˜éŒ„å—ï¼Ÿ")) {
                localStorage.removeItem('my_timer_records');
                recordListContainer.innerHTML = '';
            }
        }

        function toggleDrawer() { document.getElementById('drawer').classList.toggle('open'); }
    </script>
</body>
</html>
